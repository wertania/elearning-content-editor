version: "3.8"
name: e-learning-plattform
services:
  pocketbase:
    image: spectado/pocketbase:latest
    container_name: pocketbase
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      - /tmp/pb/data:/pb_data
      - /tmp/pb/public:/pb_public
      - /tmp/pb/migrations:/pb_migrations
  
  editor:
    build:
      context: ./editor
      args:
        VITE_BASE_LANGUAGE: ${VITE_BASE_LANGUAGE}
        VITE_AVAILABLE_LANGUAGES: ${VITE_AVAILABLE_LANGUAGES}
        VITE_DOCUMENT_DATASOURCE: ${VITE_DOCUMENT_DATASOURCE}
        VITE_POCKETBASE_URL: ${VITE_POCKETBASE_URL}
        VITE_OPENAI_KEY: ${VITE_OPENAI_KEY}
        VITE_VIDEOCONVERTER_URL: ${VITE_VIDEOCONVERTER_URL}
        VITE_TEMPLATE_START_LOGO: ${VITE_TEMPLATE_START_LOGO}
        VITE_TEMPLATE_WELCOME_SLOGAN: ${VITE_TEMPLATE_WELCOME_SLOGAN}
        VITE_TEMPLATE_APP_NAME: ${VITE_TEMPLATE_APP_NAME}
        VITE_TEMPLATE_LOGO_URL: ${VITE_TEMPLATE_LOGO_URL}
    ports:
      - "9000:80"

  video-convert-service-preprocess:
    build:
      context: .
      dockerfile: ./video-convert/docker/Dockerfile.video-convert.service
    volumes:
      - ./video-convert:/app
    restart: always
    # cpus: 2

  video-convert-service:
    build:
      context: .
      dockerfile: ./video-convert/docker/Dockerfile.preprocess.service
    volumes:
      - ./video-convert:/app
    restart: always
    # cpus: 2

  user-verification:
    build:
      context: .
      dockerfile: ./video-convert/docker/Dockerfile.user-verification.service
    volumes:
      - ./video-convert:/app
    restart: on-failure
    # cpus: 2
